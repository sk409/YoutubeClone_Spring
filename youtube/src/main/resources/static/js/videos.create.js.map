{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/main/resources/js/videos.create.js"],"names":["STEP_VIDEO_SELECTION","STEP_ADVANCED_SETTING","Vue","el","data","steps","active","thumbnail","selectedIndex","video","file","detailForm","title","description","rules","required","message","name","url","computed","isVideoSelectionStep","isAdvancedSettingStep","methods","setVideo","e","preventDefault","files","dataTransfer","length","$notify","error","duration","NOTIFICATION","normal","type","startsWith","PATH","join","SERVER_ORIGIN","UUID","success","$nextTick","$refs","src","URL","createObjectURL","load","tmpVideo","document","createElement","onloadeddata","dstWidth","dstHeight","thumbnailUpload","clientWidth","clientHeight","canvases","setImageData","index","currentTime","onseeked","canvas","width","videoWidth","height","videoHeight","context","getContext","drawImage","imageData","getImageData","resizedData","Uint8ClampedArray","ImageInterpolator","nearestNeighbor","resizedImageData","ImageData","putImageData","selectThumbnail","thumbnailStyle","border","COLOR","uploadVideo","validate","valid","formData","FormData","append","axios","post","ROUTES","videos","store","HTTP","header","contentType","multipartFormData","then","response","status","ok","location","href","dashboard"],"mappings":"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","file":"videos.create.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/main/resources/js/videos.create.js\");\n","const STEP_VIDEO_SELECTION = 1;\nconst STEP_ADVANCED_SETTING = 2;\n// const STEP_PUBLISHING_SETTING = 3;\n\nnew Vue({\n    el: \"#videos-create\",\n    data: {\n        steps: {\n            active: STEP_VIDEO_SELECTION,\n        },\n        thumbnail: {\n            selectedIndex: 0,\n        },\n        video: {\n            file: null,\n            detailForm: {\n                title: null,\n                description: null,\n                rules: {\n                    title: [{\n                        required: true,\n                        message: \"タイトルを入力してください\"\n                    }],\n                    description: [{\n                        required: true,\n                        message: \"説明を入力してください\"\n                    }]\n                }\n            },\n            name: null,\n            url: null,\n        }\n    },\n    computed: {\n        isVideoSelectionStep() {\n            return this.steps.active === STEP_VIDEO_SELECTION;\n        },\n        isAdvancedSettingStep() {\n            return this.steps.active === STEP_ADVANCED_SETTING;\n        },\n        // isPublishingSettingStep() {\n        //     return this.steps.active === STEP_PUBLISHING_SETTING;\n        // },\n    },\n    methods: {\n        setVideo(e) {\n            e.preventDefault();\n            const files = e.dataTransfer.files;\n            if (files.length === 0) {\n                this.$notify.error({\n                    message: \"ファイルがありません\",\n                    duration: NOTIFICATION.duration.normal\n                });\n                return;\n            }\n            const file = files[0];\n            if (!file.type.startsWith(\"video\")) {\n                this.$notify.error({\n                    message: \"動画以外はアップロードできません\",\n                    duration: NOTIFICATION.duration.normal\n                });\n                return;\n            }\n            this.video.file = file;\n            this.video.name = file.name;\n            this.video.url = PATH.join(SERVER_ORIGIN, UUID());\n            this.steps.active = STEP_ADVANCED_SETTING;\n            this.$notify.success({\n                message: \"動画を選択しました\",\n                duration: NOTIFICATION.duration.normal,\n            });\n            this.$nextTick(() => {\n                const video = this.$refs.video;\n                video.src = URL.createObjectURL(file);\n                video.load();\n                const tmpVideo = document.createElement(\"video\");\n                tmpVideo.src = URL.createObjectURL(file);\n                tmpVideo.load();\n                tmpVideo.onloadeddata = () => {\n                    const dstWidth = 213;\n                    const dstHeight = 120;\n                    const thumbnailUpload = this.$refs.thumbnailUpload;\n                    thumbnailUpload.clientWidth = dstWidth;\n                    thumbnailUpload.clientHeight = dstHeight;\n                    const canvases = this.$refs.canvases;\n                    const setImageData = (index) => {\n                        if (index === canvases.length) {\n                            return;\n                        }\n                        tmpVideo.currentTime = tmpVideo.duration * index / canvases.length;\n                        tmpVideo.onseeked = function () {\n                            const canvas = canvases[index];\n                            canvas.width = tmpVideo.videoWidth;\n                            canvas.height = tmpVideo.videoHeight;\n                            const context = canvas.getContext(\"2d\");\n                            context.drawImage(tmpVideo, 0, 0);\n                            const imageData = context.getImageData(0, 0, canvas.width, canvas.height);\n                            const resizedData = new Uint8ClampedArray(\n                                ImageInterpolator.nearestNeighbor(imageData.data, canvas.width, canvas.height, dstWidth, dstHeight)\n                            );\n                            const resizedImageData = new ImageData(resizedData, dstWidth, dstHeight);\n                            canvas.width = dstWidth;\n                            canvas.height = dstHeight;\n                            context.putImageData(resizedImageData, 0, 0);\n                            setImageData(index + 1);\n                        };\n                    };\n                    setImageData(0);\n                };\n            });\n        },\n        selectThumbnail(index) {\n            this.thumbnail.selectedIndex = index;\n        },\n        thumbnailStyle(index) {\n            if (index !== this.thumbnail.selectedIndex) {\n                return {\n                    border: \"3px solid rgba(0, 0, 0, 0)\"\n                };\n            }\n            return {\n                border: `3px solid ${COLOR.success}`\n            };\n        },\n        uploadVideo() {\n            this.$refs.detailForm.validate(valid => {\n                if (!valid) {\n                    return;\n                }\n                const formData = new FormData();\n                formData.append(\"title\", this.video.detailForm.title);\n                formData.append(\"description\", this.video.detailForm.description);\n                formData.append(\"video\", this.video.file);\n                axios.post(ROUTES.videos.store(), formData, {\n                    \"Content-Type\": HTTP.header.contentType.multipartFormData\n                }).then(response => {\n                    if (response.status === HTTP.status.ok) {\n                        this.$notify.success({\n                            message: \"動画をアップロードしました\",\n                            duration: NOTIFICATION.duration.normal\n                        });\n                        location.href = ROUTES.dashboard.videos();\n                    } else {\n                        this.$notify.error({\n                            message: \"動画をアップロードできませんでした\",\n                            duration: NOTIFICATION.duration.normal\n                        });\n                    }\n                });\n            });\n        }\n    }\n});"],"sourceRoot":""}